(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{"Np/R":function(t,n,e){"use strict";e.r(n),e.d(n,"LineDetailModule",function(){return u});var i=e("y/yF"),o=e("XNiG"),s=e("fXoL"),a=e("tyNb"),l=e("gqXN"),A=e("ofXK");const r=["lineDetailStation"],c=["item"];function d(t,n){1&t&&(s.Nb(0,"div",7),s.Nb(1,"div",8),s.Jb(2,"div"),s.Jb(3,"div"),s.Jb(4,"div"),s.Jb(5,"div"),s.Mb(),s.Mb())}function p(t,n){if(1&t&&(s.Nb(0,"span"),s.jc(1),s.Mb()),2&t){const t=s.Wb(2);s.xb(1),s.mc(" \u9996",t.detail.start_time.substring(0,2),":",t.detail.start_time.substring(2,4)," ")}}function h(t,n){if(1&t&&(s.Nb(0,"span",19),s.jc(1),s.Mb()),2&t){const t=s.Wb(2);s.xb(1),s.mc(" \u672b",t.detail.end_time.substring(0,2),":",t.detail.end_time.substring(2,4)," ")}}function g(t,n){if(1&t&&(s.Nb(0,"span"),s.jc(1),s.Mb()),2&t){const t=s.Wb(2);s.xb(1),s.lc(" \u7968\u4ef7:",t.detail.total_price,"\u5143 ")}}function b(t,n){if(1&t){const t=s.Ob();s.Nb(0,"div",9),s.Nb(1,"div",10),s.jc(2),s.Mb(),s.Nb(3,"div",11),s.jc(4),s.Jb(5,"img",12),s.jc(6),s.Nb(7,"div",13),s.Ub("click",function(){s.dc(t);const n=s.Wb();return n.exchange(n.detail.direc)}),s.Jb(8,"img",14),s.Nb(9,"span",15),s.jc(10,"\u6362\u5411"),s.Mb(),s.Mb(),s.Mb(),s.Nb(11,"div",16),s.ic(12,p,2,2,"span",17),s.ic(13,h,2,2,"span",18),s.ic(14,g,2,1,"span",17),s.Mb(),s.Mb()}if(2&t){const t=s.Wb();s.xb(2),s.lc(" ",t.detail.key_name," "),s.xb(2),s.lc(" ",t.detail.front_name," "),s.xb(2),s.lc(" ",t.detail.terminal_name," "),s.xb(6),s.Xb("ngIf",t.detail.start_time),s.xb(1),s.Xb("ngIf",t.detail.end_time),s.xb(1),s.Xb("ngIf",t.detail.total_price)}}function m(t,n){if(1&t){const t=s.Ob();s.Nb(0,"li",20,21),s.Ub("click",function(e){s.dc(t);const i=n.index,o=n.$implicit;return s.Wb().selectedStation(i,o,e)}),s.jc(2),s.Jb(3,"div",22),s.Nb(4,"div",23),s.Jb(5,"img",24),s.Mb(),s.Jb(6,"div",25),s.Mb()}if(2&t){const t=n.$implicit;s.Ab("current",t.selected),s.xb(2),s.lc(" ",t.name," ")}}const M=[{path:"",component:(()=>{class t{constructor(t,n){this.route=t,this.amapService=n,this.detail={stations:[]},this.loading=!0,this.marker=[],this.selectedMarker=[],this.startEndMarker=[],this.polyline=null,this.lastId=0,this.selectLocation=new o.a,this.stationCount=0,this.selectedIndex=null}ngOnInit(){this.map=new AMap.Map("map",{rotateEnable:!1,center:null!=this.amapService.location?this.amapService.location.position:null,zoom:null!=this.amapService.location?14:null}),this.selectLocation.subscribe(t=>{this.onSelectedLocation(t)}),this.route.params.subscribe(t=>{this.loadGeolocation(this.map,t.id)})}ngAfterViewInit(){this.scrollElement=this.detailStation.nativeElement,this.scrollElement.style.height=window.innerHeight-300+"px",this.itemElements.changes.subscribe(t=>this.onItemElementsChanged())}exchange(t){t.length<1||(this.loading=!0,this.selectedIndex=null,this.loadLineStation(this.amapService.location.position,t))}selectedStation(t,n,e){if(t==this.selectedIndex)return;this.detail.stations.map((n,e)=>{n.selected=e==t}),this.selectedIndex=t;const i=n.xy_coords.split(";");this.selectLocation.next({index:t,position:i}),this.map.setZoomAndCenter(15,i,!1,500),this.onItemElementsChanged()}onItemElementsChanged(){this.itemElements.find((t,n)=>n==this.selectedIndex).nativeElement.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})}onSelectedLocation(t){this.selectedMarker[this.lastId].hide(),this.selectedMarker[t.index].show(),0!=this.lastId&&this.lastId!=this.stationCount-1&&(this.marker[this.lastId].setIcon(new AMap.Icon({size:new AMap.Size(12,12),image:"assets/images/amap/station_location.png",imageSize:new AMap.Size(12,12)})),this.marker[this.lastId].setOptions({zooms:[15,20]})),this.lastId=t.index,0!=t.index&&t.index!=this.stationCount-1&&(this.marker[t.index].setIcon(new AMap.Icon({size:new AMap.Size(12,12),image:"assets/images/amap/station_location_point.png",imageSize:new AMap.Size(12,12)})),this.marker[t.index].setOptions({zooms:[2,20]}))}loadGeolocation(t,n){const e=this;AMap.plugin("AMap.Geolocation",function(){const i=new AMap.Geolocation({enableHighAccuracy:!0,timeout:5e3,position:"RB",buttonOffset:new AMap.Pixel(10,20),zoomToAccuracy:!1,panToLocation:!0,showMarker:!0,showButton:!1,showCircle:!1,markerOptions:{icon:new AMap.Icon({size:new AMap.Size(32,32),image:"assets/images/amap/location.webp",imageSize:new AMap.Size(32,32)}),angle:180,clickable:!1}});e.amapService.geolocation=i,t.addControl(i),i.getCurrentPosition((t,i)=>{"complete"===t&&(e.amapService.location=i,e.loadLineStation(i.position,n))})})}loadLineStation(t,n){this.amapService.getLineDetail(n).subscribe(n=>{this.loading=!1;let e=n.busline_list[n.busline_count-1];this.stationCount=e.stations.length,this.drawRoute(e,t),this.detail=e})}drawRoute(t,n){const e=t.stations;this.startEndPoint(e[0].xy_coords,e[this.stationCount-1].xy_coords);const i=[],o=this.amapService.selectedLine;let s=[];const a=[];e.forEach((t,n)=>{const e=t.xy_coords.split(";");t.selected=null!=o&&o.stationid==t.station_id,t.selected&&(this.selectedIndex=n,s=e),this.stationMarker(e,t.name,0==n||n==this.stationCount-1||t.selected,n),this.selectedStationMarker(e,n)}),this.hiddenResidueMarker(),null==this.selectedIndex&&(e.forEach((t,e)=>{const i=t.xy_coords.split(";"),o=new AMap.LngLat(i[0],i[1]),s=Math.round(n.distance(o));a.push({d:s,index:e})}),a.sort((t,n)=>t.d-n.d),this.selectedIndex=a[0].index,s=e[this.selectedIndex].xy_coords.split(";"),e[this.selectedIndex].selected=!0),console.log(e),console.log(this.selectedIndex),this.selectLocation.next({index:this.selectedIndex,position:s});const l=t.xs.split(","),A=t.ys.split(",");l.forEach((t,n)=>{i.push(new AMap.LngLat(t,A[n]))}),null==this.polyline?(this.polyline=new AMap.Polyline({path:i,isOutline:!1,outlineColor:"#ffeeee",borderWeight:2,strokeWeight:6,strokeColor:"#0091ff",strokeOpacity:1,lineJoin:"round",strokeStyle:"solid"}),this.map.add(this.polyline)):this.polyline.setPath(i),this.map.add(this.marker),null!=this.amapService.location?this.map.setZoomAndCenter(14,this.amapService.location.position,!1,500):this.map.setZoom(14)}hiddenResidueMarker(){if(this.marker.length>this.stationCount){const t=this.marker.length-this.stationCount;for(let n=0;n<t;n++)this.marker[this.stationCount+n].hide()}}stationMarker(t,n,e,i){this.marker.length-1<i?this.marker.push(this.getMarker(t,n,e)):(this.marker[i].setPosition(t),this.marker[i].setLabel({content:"<div style='border: none;color: #1A1B1C; font-weight: 500;'>"+n+"</div>",direction:"bottom",offset:new AMap.Pixel(0,3)}))}selectedStationMarker(t,n){this.selectedMarker.length-1<n?this.selectedMarker.push(this.getStationMarker(t)):this.selectedMarker[n].setPosition(t)}startEndPoint(t,n){const e=t.split(";"),i=n.split(";"),o=new AMap.Icon({size:new AMap.Size(28,28),image:"assets/images/amap/bubble_start.webp",imageSize:new AMap.Size(28,28)}),s=new AMap.Icon({size:new AMap.Size(28,28),image:"assets/images/amap/bubble_end.webp",imageSize:new AMap.Size(28,28)});if(this.startEndMarker.length<1)return this.startEndMarker[0]=new AMap.Marker({position:e,icon:o,map:this.map,anchor:"bottom-center",zIndex:14}),void(this.startEndMarker[1]=new AMap.Marker({position:i,icon:s,map:this.map,anchor:"bottom-center",zIndex:14}));this.startEndMarker[0].setPosition(e),this.startEndMarker[0].setIcon(o),this.startEndMarker[1].setPosition(i),this.startEndMarker[1].setIcon(s)}getMarker(t,n,e){return new AMap.Marker({position:t,title:n,icon:new AMap.Icon({size:new AMap.Size(12,12),image:e?"assets/images/amap/station_location_point.png":"assets/images/amap/station_location.png",imageSize:new AMap.Size(12,12)}),anchor:"center",zooms:[e?2:15,20],label:{content:"<div style='border: none;color: #1A1B1C; font-weight: 500;'>"+n+"</div>",direction:"bottom",offset:new AMap.Pixel(0,3)},zIndex:12})}getStationMarker(t){return new AMap.Marker({position:t,icon:new AMap.Icon({size:new AMap.Size(29,32),image:"assets/images/amap/drive_bus_station.webp",imageSize:new AMap.Size(29,32)}),anchor:"bottom-center",zIndex:15,map:this.map,visible:!1})}}return t.\u0275fac=function(n){return new(n||t)(s.Ib(a.a),s.Ib(l.a))},t.\u0275cmp=s.Cb({type:t,selectors:[["app-line-detail"]],viewQuery:function(t,n){if(1&t&&(s.gc(r,!0),s.nc(c,!0)),2&t){let t;s.ac(t=s.Vb())&&(n.detailStation=t.first),s.ac(t=s.Vb())&&(n.itemElements=t)}},decls:8,vars:3,consts:[["id","loading-spinner",4,"ngIf"],[1,"page-line-detail"],["id","map"],["class","line-detail-info",4,"ngIf"],[1,"line-detail-station"],["lineDetailStation",""],[3,"current","click",4,"ngFor","ngForOf"],["id","loading-spinner"],[1,"lds-ring"],[1,"line-detail-info"],[1,"line-name"],[1,"line-start-end"],["width","20","src","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAQCAYAAAB3AH1ZAAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAEAAAAAANp9p1AAAAbklEQVRIDWNgGAUjIQSkpGQacPmTGZcENcW5eXj28/HxM37+/OkAurlM6AK04v/7/68eW0jQzQEgj2FzBKOEpNR/Wvkal7lMjEyNz549aQDJ0zUEQBaCAHJIDEgIQJwB9D0wJGDsUXo0BEZuCAAAbCAZMJUp5eYAAAAASUVORK5CYII="],[2,"float","right","display","flex","cursor","pointer","color","#5B85F1",3,"click"],["width","20","src","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAbCAYAAAAdx42aAAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAGwAAAAB6d+tkAAAArUlEQVRIDe2WwQ2AIAwA0QUYUDfhIT7YRAdkArWPEgJCGrVoTPnUhKY9jlhVStZfDYzOW8rZekrSlZxNqYkCwQYA0BQIVgAKRJfqHZw/wJ9fR6N5MdqmldkNYMPSdTQDAJASBEJKFANi4BUD2SSEDwi8r5w0q9GhbzaIYFzC2OQEiGtnALDZEiKoiKnwOb2OWB3m3I2nBrBoCxNVAABpAYEHrkbK71W1gGx+1cAO96IvityZSOEAAAAASUVORK5CYII="],[2,"padding-left","2px"],[1,"line-attribute"],[4,"ngIf"],["style","padding: 0 4px;border-right: 1px #ededed solid; margin-right: 6px;",4,"ngIf"],[2,"padding","0 4px","border-right","1px #ededed solid","margin-right","6px"],[3,"click"],["item",""],[1,"line-station-detail"],[1,"gg-shape-triangle"],["alt","","width","5","src","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAJCAYAAADtj3ZXAAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAD6ADAAQAAAABAAAACQAAAACIdi6pAAAAlklEQVQoFZWRIQ+DQAxG7z+gUDgciAkslh+PnJyawowQBJLb+5YegXAwIHlcr31tSHHe+wEad+ORrz7Hq4UJ6iv98sxv1ZzAE0aozgaobp785OcSpPCCDxSxAcpbXV66cUhk8IYO8nVRd8urnq1rSxyTJEN06NIYAsQSetDnPezUvQzO6YkYFjMT/13kbhhNNWiBh7/wC8nCyhsNJQUxAAAAAElFTkSuQmCC"],[1,"line-station-point"]],template:function(t,n){1&t&&(s.ic(0,d,6,0,"div",0),s.Nb(1,"div",1),s.Jb(2,"div",2),s.ic(3,b,15,6,"div",3),s.Nb(4,"div",4),s.Nb(5,"ul",null,5),s.ic(7,m,7,3,"li",6),s.Mb(),s.Mb(),s.Mb()),2&t&&(s.Xb("ngIf",n.loading),s.xb(3),s.Xb("ngIf",n.detail.stations.length>0),s.xb(4),s.Xb("ngForOf",n.detail.stations))},directives:[A.i,A.h],styles:["",'#map[_ngcontent-%COMP%] {\n    height: 180px;\n  }\n  .page-line-detail[_ngcontent-%COMP%] {\n    position: relative;\n    max-height: 105px;\n    visibility: visible;\n  }\n  .line-detail-info[_ngcontent-%COMP%] {\n    border-top: 1px #dddddd solid;\n    padding: 8px 20px;\n    box-shadow: 0 0 4px 2px rgba(0, 0, 0, .15);\n  }\n  .line-detail-info[_ngcontent-%COMP%]   .line-name[_ngcontent-%COMP%]{\n    padding-top: 12px;\n    font-size: 20px;\n    font-weight: 500;\n  }\n  .line-detail-info[_ngcontent-%COMP%]   .line-start-end[_ngcontent-%COMP%]{\n    padding: 10px 0;\n    font-size: 14px;\n  }\n  .line-detail-info[_ngcontent-%COMP%]   .line-attribute[_ngcontent-%COMP%] {\n    color: #999999;\n    font-size: 12px;\n    font-weight: normal;\n  }\n\n  .line-detail-station[_ngcontent-%COMP%] {\n  }\n  .line-detail-station[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] {\n    height: calc(100vh - 300px);\n    overflow-x: hidden;\n    overflow-y: scroll;\n    margin: 0;\n    padding-top: 12px;\n  }\n\n  .line-detail-station[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%] {\n    position: relative;\n    padding: 15px 0 15px 15px;\n    font-size: 16px;\n    border-left: 5px #5e83f0 solid;\n    cursor: pointer;\n  }\n  .line-detail-station[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:first-child {\n    padding-top: 0;\n  }\n  .line-detail-station[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:last-child {\n    padding-bottom: 0;\n  }\n\n\n  ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .line-station-point[_ngcontent-%COMP%] {\n    position: absolute;\n    left: -8px;\n    top: 18px;\n    width: 8px;\n    height: 8px;\n    border: 2px #5e83f0 solid;\n    border-radius: 6px;\n    background: #ffffff;\n  }\n\n  ul[_ngcontent-%COMP%]   li.current[_ngcontent-%COMP%]   .line-station-point[_ngcontent-%COMP%] {\n    position: absolute;\n    left: -12px;\n    top: 18px;\n    width: 16px;\n    height: 16px;\n    border: 2px #5e83f0 solid;\n    border-radius: 12px;\n    background: #ffffff;\n  }\n\n  ul[_ngcontent-%COMP%]   li.current[_ngcontent-%COMP%]   .line-station-point[_ngcontent-%COMP%]:before {\n    position: absolute;\n    width: 8px;\n    height: 8px;\n    border-radius: 6px;\n    left: 4px;\n    top: 4px;\n    background: #5e83f0;\n    content: "";\n  }\n\n  .line-detail-station[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li.current[_ngcontent-%COMP%] {\n    font-size: 18px;\n    font-weight: 500;\n  }\n\n  ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:first-child   .line-station-point[_ngcontent-%COMP%] {\n    top: 0;\n  }\n\n  ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:last-child   .line-station-point[_ngcontent-%COMP%] {\n    top: unset;\n    bottom: 0;\n  }\n\n  .gg-shape-triangle[_ngcontent-%COMP%] {\n    left: -5px;\n    top: -15px;\n    position: absolute;\n    width: 5px;\n    height: 3px;\n  }']}),t})()}];let u=(()=>{class t{}return t.\u0275mod=s.Gb({type:t}),t.\u0275inj=s.Fb({factory:function(n){return new(n||t)},imports:[[i.a,a.c.forChild(M)]]}),t})()}}]);