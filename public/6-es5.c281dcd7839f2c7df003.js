!function(){function n(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}function t(n,t){for(var e=0;e<t.length;e++){var i=t[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{"Np/R":function(e,i,o){"use strict";o.r(i),o.d(i,"LineDetailModule",function(){return k});var a=o("y/yF"),s=o("XNiG"),l=o("fXoL"),A=o("tyNb"),r=o("gqXN"),c=o("ofXK"),d=["lineDetailStation"],p=["item"];function h(n,t){1&n&&(l.Nb(0,"div",7),l.Nb(1,"div",8),l.Jb(2,"div"),l.Jb(3,"div"),l.Jb(4,"div"),l.Jb(5,"div"),l.Mb(),l.Mb())}function g(n,t){if(1&n&&(l.Nb(0,"span"),l.lc(1),l.Mb()),2&n){var e=l.Wb(2);l.xb(1),l.oc(" \u9996",e.detail.start_time.substring(0,2),":",e.detail.start_time.substring(2,4)," ")}}function u(n,t){if(1&n&&(l.Nb(0,"span",19),l.lc(1),l.Mb()),2&n){var e=l.Wb(2);l.xb(1),l.oc(" \u672b",e.detail.end_time.substring(0,2),":",e.detail.end_time.substring(2,4)," ")}}function b(n,t){if(1&n&&(l.Nb(0,"span"),l.lc(1),l.Mb()),2&n){var e=l.Wb(2);l.xb(1),l.nc(" \u7968\u4ef7:",e.detail.total_price,"\u5143 ")}}function f(n,t){if(1&n){var e=l.Ob();l.Nb(0,"div",9),l.Nb(1,"div",10),l.lc(2),l.Mb(),l.Nb(3,"div",11),l.lc(4),l.Jb(5,"img",12),l.lc(6),l.Nb(7,"div",13),l.Ub("click",function(){l.fc(e);var n=l.Wb();return n.exchange(n.detail.direc)}),l.Jb(8,"img",14),l.Nb(9,"span",15),l.lc(10,"\u6362\u5411"),l.Mb(),l.Mb(),l.Mb(),l.Nb(11,"div",16),l.kc(12,g,2,2,"span",17),l.kc(13,u,2,2,"span",18),l.kc(14,b,2,1,"span",17),l.Mb(),l.Mb()}if(2&n){var i=l.Wb();l.xb(2),l.nc(" ",i.detail.key_name," "),l.xb(2),l.nc(" ",i.detail.front_name," "),l.xb(2),l.nc(" ",i.detail.terminal_name," "),l.xb(6),l.Zb("ngIf",i.detail.start_time),l.xb(1),l.Zb("ngIf",i.detail.end_time),l.xb(1),l.Zb("ngIf",i.detail.total_price)}}function m(n,t){if(1&n){var e=l.Ob();l.Nb(0,"li",20,21),l.Ub("click",function(n){l.fc(e);var i=t.index,o=t.$implicit;return l.Wb().selectedStation(i,o,n)}),l.lc(2),l.Jb(3,"div",22),l.Nb(4,"div",23),l.Jb(5,"img",24),l.Mb(),l.Jb(6,"div",25),l.Mb()}if(2&n){var i=t.$implicit;l.Ab("current",i.selected),l.xb(2),l.nc(" ",i.name," ")}}var M,x,v=[{path:"",component:(M=function(){function e(t,i){n(this,e),this.route=t,this.amapService=i,this.detail={stations:[]},this.loading=!0,this.marker=[],this.selectedMarker=[],this.startEndMarker=[],this.polyline=null,this.lastId=0,this.selectLocation=new s.a,this.stationCount=0,this.selectedIndex=null}var i,o,a;return i=e,(o=[{key:"ngOnInit",value:function(){var n=this;this.map=new AMap.Map("map",{rotateEnable:!1,center:null!=this.amapService.location?this.amapService.location.position:null,zoom:null!=this.amapService.location?14:null}),this.selectLocation.subscribe(function(t){n.onSelectedLocation(t)}),this.route.params.subscribe(function(t){n.loadGeolocation(n.map,t.id)})}},{key:"ngAfterViewInit",value:function(){var n=this;this.scrollElement=this.detailStation.nativeElement,this.scrollElement.style.height=window.innerHeight-300+"px",this.itemElements.changes.subscribe(function(t){return n.onItemElementsChanged()})}},{key:"exchange",value:function(n){n.length<1||(this.loading=!0,this.selectedIndex=null,this.loadLineStation(this.amapService.location.position,n))}},{key:"selectedStation",value:function(n,t,e){if(n!=this.selectedIndex){this.detail.stations.map(function(t,e){t.selected=e==n}),this.selectedIndex=n;var i=t.xy_coords.split(";");this.selectLocation.next({index:n,position:i}),this.map.setZoomAndCenter(15,i,!1,500),this.onItemElementsChanged()}}},{key:"onItemElementsChanged",value:function(){var n=this;this.itemElements.find(function(t,e){return e==n.selectedIndex}).nativeElement.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})}},{key:"onSelectedLocation",value:function(n){this.selectedMarker[this.lastId].hide(),this.selectedMarker[n.index].show(),0!=this.lastId&&this.lastId!=this.stationCount-1&&(this.marker[this.lastId].setIcon(new AMap.Icon({size:new AMap.Size(12,12),image:"assets/images/amap/station_location.png",imageSize:new AMap.Size(12,12)})),this.marker[this.lastId].setOptions({zooms:[15,20]})),this.lastId=n.index,0!=n.index&&n.index!=this.stationCount-1&&(this.marker[n.index].setIcon(new AMap.Icon({size:new AMap.Size(12,12),image:"assets/images/amap/station_location_point.png",imageSize:new AMap.Size(12,12)})),this.marker[n.index].setOptions({zooms:[2,20]}))}},{key:"loadGeolocation",value:function(n,t){var e=this;AMap.plugin("AMap.Geolocation",function(){var i=new AMap.Geolocation({enableHighAccuracy:!0,timeout:5e3,position:"RB",buttonOffset:new AMap.Pixel(10,20),zoomToAccuracy:!1,panToLocation:!0,showMarker:!0,showButton:!1,showCircle:!1,markerOptions:{icon:new AMap.Icon({size:new AMap.Size(32,32),image:"assets/images/amap/location.webp",imageSize:new AMap.Size(32,32)}),angle:180,clickable:!1}});e.amapService.geolocation=i,n.addControl(i),i.getCurrentPosition(function(n,i){"complete"===n&&(e.amapService.location=i,e.loadLineStation(i.position,t))})})}},{key:"loadLineStation",value:function(n,t){var e=this;this.amapService.getLineDetail(t).subscribe(function(t){e.loading=!1;var i=t.busline_list[t.busline_count-1];e.stationCount=i.stations.length,e.drawRoute(i,n),e.detail=i})}},{key:"drawRoute",value:function(n,t){var e=this,i=n.stations;this.startEndPoint(i[0].xy_coords,i[this.stationCount-1].xy_coords);var o=[],a=this.amapService.selectedLine,s=[],l=[];i.forEach(function(n,t){var i=n.xy_coords.split(";");n.selected=null!=a&&a.stationid==n.station_id,n.selected&&(e.selectedIndex=t,s=i),e.stationMarker(i,n.name,0==t||t==e.stationCount-1||n.selected,t),e.selectedStationMarker(i,t)}),this.hiddenResidueMarker(),null==this.selectedIndex&&(i.forEach(function(n,e){var i=n.xy_coords.split(";"),o=new AMap.LngLat(i[0],i[1]),a=Math.round(t.distance(o));l.push({d:a,index:e})}),l.sort(function(n,t){return n.d-t.d}),this.selectedIndex=l[0].index,s=i[this.selectedIndex].xy_coords.split(";"),i[this.selectedIndex].selected=!0),console.log(i),console.log(this.selectedIndex),this.selectLocation.next({index:this.selectedIndex,position:s});var A=n.xs.split(","),r=n.ys.split(",");A.forEach(function(n,t){o.push(new AMap.LngLat(n,r[t]))}),null==this.polyline?(this.polyline=new AMap.Polyline({path:o,isOutline:!1,outlineColor:"#ffeeee",borderWeight:2,strokeWeight:6,strokeColor:"#0091ff",strokeOpacity:1,lineJoin:"round",strokeStyle:"solid"}),this.map.add(this.polyline)):this.polyline.setPath(o),this.map.add(this.marker),this.map.setZoomAndCenter(14,s,!1,500)}},{key:"hiddenResidueMarker",value:function(){if(this.marker.length>this.stationCount)for(var n=this.marker.length-this.stationCount,t=0;t<n;t++)this.marker[this.stationCount+t].hide()}},{key:"stationMarker",value:function(n,t,e,i){this.marker.length-1<i?this.marker.push(this.getMarker(n,t,e)):(this.marker[i].setPosition(n),this.marker[i].setLabel({content:"<div style='border: none;color: #1A1B1C; font-weight: 500;'>"+t+"</div>",direction:"bottom",offset:new AMap.Pixel(0,3)}))}},{key:"selectedStationMarker",value:function(n,t){this.selectedMarker.length-1<t?this.selectedMarker.push(this.getStationMarker(n)):this.selectedMarker[t].setPosition(n)}},{key:"startEndPoint",value:function(n,t){var e=n.split(";"),i=t.split(";"),o=new AMap.Icon({size:new AMap.Size(28,28),image:"assets/images/amap/bubble_start.webp",imageSize:new AMap.Size(28,28)}),a=new AMap.Icon({size:new AMap.Size(28,28),image:"assets/images/amap/bubble_end.webp",imageSize:new AMap.Size(28,28)});if(this.startEndMarker.length<1)return this.startEndMarker[0]=new AMap.Marker({position:e,icon:o,map:this.map,anchor:"bottom-center",zIndex:14}),void(this.startEndMarker[1]=new AMap.Marker({position:i,icon:a,map:this.map,anchor:"bottom-center",zIndex:14}));this.startEndMarker[0].setPosition(e),this.startEndMarker[0].setIcon(o),this.startEndMarker[1].setPosition(i),this.startEndMarker[1].setIcon(a)}},{key:"getMarker",value:function(n,t,e){return new AMap.Marker({position:n,title:t,icon:new AMap.Icon({size:new AMap.Size(12,12),image:e?"assets/images/amap/station_location_point.png":"assets/images/amap/station_location.png",imageSize:new AMap.Size(12,12)}),anchor:"center",zooms:[e?2:15,20],label:{content:"<div style='border: none;color: #1A1B1C; font-weight: 500;'>"+t+"</div>",direction:"bottom",offset:new AMap.Pixel(0,3)},zIndex:12})}},{key:"getStationMarker",value:function(n){return new AMap.Marker({position:n,icon:new AMap.Icon({size:new AMap.Size(29,32),image:"assets/images/amap/drive_bus_station.webp",imageSize:new AMap.Size(29,32)}),anchor:"bottom-center",zIndex:15,map:this.map,visible:!1})}}])&&t(i.prototype,o),a&&t(i,a),e}(),M.\u0275fac=function(n){return new(n||M)(l.Ib(A.a),l.Ib(r.a))},M.\u0275cmp=l.Cb({type:M,selectors:[["app-line-detail"]],viewQuery:function(n,t){var e;1&n&&(l.ic(d,!0),l.pc(p,!0)),2&n&&(l.cc(e=l.Vb())&&(t.detailStation=e.first),l.cc(e=l.Vb())&&(t.itemElements=e))},decls:8,vars:3,consts:[["id","loading-spinner",4,"ngIf"],[1,"page-line-detail"],["id","map"],["class","line-detail-info",4,"ngIf"],[1,"line-detail-station"],["lineDetailStation",""],[3,"current","click",4,"ngFor","ngForOf"],["id","loading-spinner"],[1,"lds-ring"],[1,"line-detail-info"],[1,"line-name"],[1,"line-start-end"],["width","20","src","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAQCAYAAAB3AH1ZAAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAEAAAAAANp9p1AAAAbklEQVRIDWNgGAUjIQSkpGQacPmTGZcENcW5eXj28/HxM37+/OkAurlM6AK04v/7/68eW0jQzQEgj2FzBKOEpNR/Wvkal7lMjEyNz549aQDJ0zUEQBaCAHJIDEgIQJwB9D0wJGDsUXo0BEZuCAAAbCAZMJUp5eYAAAAASUVORK5CYII="],[2,"float","right","display","flex","cursor","pointer","color","#5B85F1",3,"click"],["width","20","height","16","src","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAbCAYAAAAdx42aAAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAGwAAAAB6d+tkAAAArUlEQVRIDe2WwQ2AIAwA0QUYUDfhIT7YRAdkArWPEgJCGrVoTPnUhKY9jlhVStZfDYzOW8rZekrSlZxNqYkCwQYA0BQIVgAKRJfqHZw/wJ9fR6N5MdqmldkNYMPSdTQDAJASBEJKFANi4BUD2SSEDwi8r5w0q9GhbzaIYFzC2OQEiGtnALDZEiKoiKnwOb2OWB3m3I2nBrBoCxNVAABpAYEHrkbK71W1gGx+1cAO96IvityZSOEAAAAASUVORK5CYII="],[2,"padding-left","2px"],[1,"line-attribute"],[4,"ngIf"],["style","padding: 0 4px;border-right: 1px #ededed solid; margin-right: 6px;",4,"ngIf"],[2,"padding","0 4px","border-right","1px #ededed solid","margin-right","6px"],[3,"click"],["item",""],[1,"line-station-detail"],[1,"gg-shape-triangle"],["alt","","width","5","src","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAJCAYAAADtj3ZXAAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAD6ADAAQAAAABAAAACQAAAACIdi6pAAAAlklEQVQoFZWRIQ+DQAxG7z+gUDgciAkslh+PnJyawowQBJLb+5YegXAwIHlcr31tSHHe+wEad+ORrz7Hq4UJ6iv98sxv1ZzAE0aozgaobp785OcSpPCCDxSxAcpbXV66cUhk8IYO8nVRd8urnq1rSxyTJEN06NIYAsQSetDnPezUvQzO6YkYFjMT/13kbhhNNWiBh7/wC8nCyhsNJQUxAAAAAElFTkSuQmCC"],[1,"line-station-point"]],template:function(n,t){1&n&&(l.kc(0,h,6,0,"div",0),l.Nb(1,"div",1),l.Jb(2,"div",2),l.kc(3,f,15,6,"div",3),l.Nb(4,"div",4),l.Nb(5,"ul",null,5),l.kc(7,m,7,3,"li",6),l.Mb(),l.Mb(),l.Mb()),2&n&&(l.Zb("ngIf",t.loading),l.xb(3),l.Zb("ngIf",t.detail.stations.length>0),l.xb(4),l.Zb("ngForOf",t.detail.stations))},directives:[c.j,c.i],styles:["",'#map[_ngcontent-%COMP%] {\n    height: 180px;\n  }\n  .page-line-detail[_ngcontent-%COMP%] {\n    position: relative;\n    max-height: 105px;\n    visibility: visible;\n  }\n  .line-detail-info[_ngcontent-%COMP%] {\n    border-top: 1px #dddddd solid;\n    padding: 8px 20px;\n    box-shadow: 0 0 4px 2px rgba(0, 0, 0, .15);\n  }\n  .line-detail-info[_ngcontent-%COMP%]   .line-name[_ngcontent-%COMP%]{\n    padding-top: 12px;\n    font-size: 20px;\n    font-weight: 500;\n  }\n  .line-detail-info[_ngcontent-%COMP%]   .line-start-end[_ngcontent-%COMP%]{\n    padding: 10px 0;\n    font-size: 14px;\n  }\n  .line-detail-info[_ngcontent-%COMP%]   .line-attribute[_ngcontent-%COMP%] {\n    color: #999999;\n    font-size: 12px;\n    font-weight: normal;\n  }\n\n  .line-detail-station[_ngcontent-%COMP%] {\n  }\n  .line-detail-station[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] {\n    height: calc(100vh - 300px);\n    overflow-x: hidden;\n    overflow-y: scroll;\n    margin: 0;\n    padding-top: 12px;\n  }\n\n  .line-detail-station[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%] {\n    position: relative;\n    padding: 15px 0 15px 15px;\n    font-size: 16px;\n    border-left: 5px #5e83f0 solid;\n    cursor: pointer;\n  }\n  .line-detail-station[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:first-child {\n    padding-top: 0;\n  }\n  .line-detail-station[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:last-child {\n    padding-bottom: 0;\n  }\n\n\n  ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .line-station-point[_ngcontent-%COMP%] {\n    position: absolute;\n    left: -8px;\n    top: 18px;\n    width: 8px;\n    height: 8px;\n    border: 2px #5e83f0 solid;\n    border-radius: 6px;\n    background: #ffffff;\n  }\n\n  ul[_ngcontent-%COMP%]   li.current[_ngcontent-%COMP%]   .line-station-point[_ngcontent-%COMP%] {\n    position: absolute;\n    left: -12px;\n    top: 18px;\n    width: 16px;\n    height: 16px;\n    border: 2px #5e83f0 solid;\n    border-radius: 12px;\n    background: #ffffff;\n  }\n\n  ul[_ngcontent-%COMP%]   li.current[_ngcontent-%COMP%]   .line-station-point[_ngcontent-%COMP%]:before {\n    position: absolute;\n    width: 8px;\n    height: 8px;\n    border-radius: 6px;\n    left: 4px;\n    top: 4px;\n    background: #5e83f0;\n    content: "";\n  }\n\n  .line-detail-station[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li.current[_ngcontent-%COMP%] {\n    font-size: 18px;\n    font-weight: 500;\n  }\n\n  ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:first-child   .line-station-point[_ngcontent-%COMP%] {\n    top: 0;\n  }\n\n  ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:last-child   .line-station-point[_ngcontent-%COMP%] {\n    top: unset;\n    bottom: 0;\n  }\n\n  .gg-shape-triangle[_ngcontent-%COMP%] {\n    left: -5px;\n    top: -15px;\n    position: absolute;\n    width: 5px;\n    height: 3px;\n  }']}),M)}],k=((x=function t(){n(this,t)}).\u0275mod=l.Gb({type:x}),x.\u0275inj=l.Fb({factory:function(n){return new(n||x)},imports:[[a.a,A.c.forChild(v)]]}),x)}}])}();